(this.webpackJsonpreact_ts_skyway=this.webpackJsonpreact_ts_skyway||[]).push([[0],{13:function(e,t,o){e.exports=o(42)},18:function(e,t,o){},41:function(e,t,o){},42:function(e,t,o){"use strict";o.r(t);var n=o(7),a=o(8),i=o(1),s=o(12),r=o(11),l=o(0),c=o.n(l),d=o(9),m=o.n(d);o(18);var u=function(e){var t=Object(l.useRef)(null);return Object(l.useEffect)((function(){var o=e.stream,n=0;e.volume&&(n=e.volume);var a=t.current;null!=a?(a.srcObject===o?console.log("useEffect() same stream, so skip:",o):(a.srcObject=o,console.log("useEffect() set stream:",o)),a.volume=n):console.log("useEffect() ref.current NULL")})),console.log("Video rendering, id=%s",e.id),e.controls?c.a.createElement("video",{className:"video_with_border",ref:t,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0,controls:!0}):c.a.createElement("video",{className:"video_with_border",ref:t,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0})},h=o(10),p=o.n(h),v=(o(41),"skyway-test"),g=function(){var e=window.location.search,t=new RegExp("room=([^&=]+)").exec(e),o="";t&&(o=t[1]);return o}();g&&""!==g&&(v=g);var f="",y=function(){var e=window.location.search,t=new RegExp("key=([^&=]+)").exec(e),o=null;t&&(o=t[1]);return o}();y&&""!==y&&(f=y);var b=function(e){Object(s.a)(o,e);var t=Object(r.a)(o);function o(e){var a;return Object(n.a)(this,o),(a=t.call(this,e)).localStream=void 0,a.room=void 0,a.peer=void 0,a.state=void 0,a.localStream=null,a.state={playing:!1,connected:!1,roomId:v,signalingKey:f,remoteStreams:{}},a.startVideo=a.startVideo.bind(Object(i.a)(a)),a.stopVideoHandler=a.stopVideoHandler.bind(Object(i.a)(a)),a.stopVideo=a.stopVideo.bind(Object(i.a)(a)),a.connect=a.connect.bind(Object(i.a)(a)),a.disconnect=a.disconnect.bind(Object(i.a)(a)),a.handleRoomChange=a.handleRoomChange.bind(Object(i.a)(a)),a.handleKeyChange=a.handleKeyChange.bind(Object(i.a)(a)),a.addRemoteStream=a.addRemoteStream.bind(Object(i.a)(a)),a.removeRemoteStream=a.removeRemoteStream.bind(Object(i.a)(a)),a.removeAllRemoteStream=a.removeAllRemoteStream.bind(Object(i.a)(a)),a.room=null,a.peer=null,a}return Object(a.a)(o,[{key:"componentDidMount",value:function(){console.log("App DidMound()")}},{key:"componentWillUnmount",value:function(){console.log("App WillUnmount()"),this.localStream&&this.stopVideo()}},{key:"startVideo",value:function(e){var t=this;if(e.preventDefault(),console.log("start Video"),this.localStream)console.warn("localVideo ALREADY started");else{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){t.localStream=e,t.setState({playing:!0})})).catch((function(e){return console.error("media ERROR:",e)}))}}},{key:"stopVideoHandler",value:function(e){e.preventDefault(),console.log("stop Video"),this.stopVideo()}},{key:"stopVideo",value:function(){this.localStream&&(this.localStream.getTracks().forEach((function(e){return e.stop()})),this.localStream=null,this.setState({playing:!1}))}},{key:"connect",value:function(e){var t=this;e.preventDefault(),console.log("connect"),this.room?console.warn("ALREADY connected"):(console.log("connecting roomId=%s key=%s",this.state.roomId,this.state.signalingKey),this.peer=new p.a({key:this.state.signalingKey,debug:2}),this.peer.on("open",(function(){console.log("peer open. id=",t.peer.id),t.joinRoom()})),this.peer.on("error",console.error))}},{key:"joinRoom",value:function(){var e=this,t=this.peer.joinRoom(this.state.roomId,{mode:"sfu",stream:this.localStream});t.on("open",(function(){console.log("room open"),e.setState({connected:!0})})),t.on("peerJoin",(function(e){console.log("= new Peer id=".concat(e," joined ==="))})),t.on("stream",(function(t){console.log("addstream id=%s",t.id,t.peerId);var o="remote_"+t.peerId;e.addRemoteStream(o,t)})),t.on("peerLeave",(function(t){console.log("peerLeave peerId=%s",t);var o="remote_"+t;e.removeRemoteStream(o)})),t.on("close",(function(){console.log("room closed")})),this.room=t}},{key:"disconnect",value:function(e){e.preventDefault(),console.log("disconnect"),this.handleDisconnect()}},{key:"handleDisconnect",value:function(){this.room&&(this.room.close(),this.room=null),this.localStream&&(this.localStream.getTracks().forEach((function(e){return e.stop()})),this.localStream=null,this.setState({playing:!1})),this.removeAllRemoteStream(),this.setState({connected:!1})}},{key:"handleRoomChange",value:function(e){this.setState({roomId:e.target.value})}},{key:"handleKeyChange",value:function(e){this.setState({signalingKey:e.target.value})}},{key:"addRemoteStream",value:function(e,t){var o=Object.assign({},this.state.remoteStreams);o[e]=t,this.setState({remoteStreams:o})}},{key:"removeRemoteStream",value:function(e){var t=Object.assign({},this.state.remoteStreams);delete t[e],this.setState({remoteStreams:t})}},{key:"removeAllRemoteStream",value:function(){this.setState({remoteStreams:{}})}},{key:"render",value:function(){console.log("App render()");var e=[];return Object.keys(this.state.remoteStreams).forEach((function(t){var o=this[t];console.log("key=id=%s, stream.id=%s",t,o.id),e.push(c.a.createElement(u,{id:t,key:t,width:"320px",height:"240px",volume:.5,controls:!0,stream:o}))}),this.state.remoteStreams),c.a.createElement("div",{className:"App"},"React - Skyway example",c.a.createElement("br",null),c.a.createElement("button",{onClick:this.startVideo,disabled:this.state.playing||this.state.connected}," Start Video"),c.a.createElement("button",{onClick:this.stopVideo,disabled:!this.state.playing||this.state.connected},"Stop Video"),c.a.createElement("br",null),"API Key: ",c.a.createElement("input",{id:"signaling_key",type:"text",size:32,value:this.state.signalingKey,onChange:this.handleKeyChange,disabled:this.state.connected}),c.a.createElement("br",null),"Room: ",c.a.createElement("input",{id:"room_id",type:"text",value:this.state.roomId,onChange:this.handleRoomChange,disabled:this.state.connected}),c.a.createElement("button",{onClick:this.connect,disabled:this.state.connected||!this.state.playing}," Connect"),c.a.createElement("button",{onClick:this.disconnect,disabled:!this.state.connected},"Disconnect"),c.a.createElement("br",null),c.a.createElement("div",{className:"VideoContainer"},c.a.createElement(u,{id:"local_video",width:"160px",height:"120px",stream:this.localStream}),c.a.createElement("div",{className:"RemoteContainer"},e)))}}]),o}(c.a.Component);m.a.render(c.a.createElement(b,null),document.getElementById("root"))}},[[13,1,2]]]);
//# sourceMappingURL=main.6d2549f5.chunk.js.map